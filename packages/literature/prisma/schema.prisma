generator client {
    provider        = "prisma-client-js"
    previewFeatures = ["multiSchema"]
    output          = "generated"
}

datasource db {
    provider = "postgresql"
    url      = env("DATABASE_URL")
    schemas  = ["literature"]
}

model Player {
    id     String
    name   String
    avatar String
    gameId String
    game   Game          @relation(fields: [gameId], references: [id])
    cards  CardMapping[]
    team   Team?         @relation(fields: [teamId], references: [id])
    teamId String?

    @@id([id, gameId])
    @@map("players")
    @@schema("literature")
}

model Team {
    id      String   @id @default(cuid())
    name    String
    gameId  String
    game    Game     @relation(fields: [gameId], references: [id])
    score   Int      @default(0)
    setsWon String[]
    members Player[]

    @@map("teams")
    @@schema("literature")
}

enum GameStatus {
    CREATED
    PLAYERS_READY
    TEAMS_CREATED
    IN_PROGRESS
    COMPLETED

    @@schema("literature")
}

model Game {
    id           String        @id @default(cuid())
    code         String        @unique
    status       GameStatus    @default(CREATED)
    playerCount  Int           @default(2)
    players      Player[]
    teams        Team[]
    cardMappings CardMapping[]
    moves        Move[]
    currentTurn  String        @default("")

    @@map("games")
    @@schema("literature")
}

model CardMapping {
    cardId   String
    gameId   String
    game     Game   @relation(fields: [gameId], references: [id])
    playerId String
    player   Player @relation(fields: [playerId, gameId], references: [id, gameId])

    @@id([cardId, gameId])
    @@map("card_mappings")
    @@schema("literature")
}

enum MoveType {
    ASK_CARD
    CALL_SET
    TRANSFER_CHANCE

    @@map("move_type")
    @@schema("literature")
}

model Move {
    id          String   @default(cuid())
    gameId      String
    game        Game     @relation(fields: [gameId], references: [id])
    type        MoveType
    data        Json
    success     Boolean
    timestamp   DateTime @default(now())
    description String

    @@id([id, gameId])
    @@map("moves")
    @@schema("literature")
}
